Template.registry.helpers({
});

Template.registry.events({
    'submit #create-new-security': function (e, template) {

        e.preventDefault();

        var account = Session.get('accounts:selected:address');
        var quant = parseInt(template.find("input[name=quantity]").value);
        var registry = Session.get('registry:selected:address');

        var options = {
            from: account,
            data: '6060604052604051604080610706833981016040528080519060200190919080519060200190919050505b8073ffffffffffffffffffffffffffffffffffffffff16634f2be91f604051817c01000000000000000000000000000000000000000000000000000000000281526004018090506000604051808303816000876161da5a03f1156100025750505081600360005060003373ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000506000600081526020019081526020016000206000508190555033600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055505b50506105f6806101106000396000f360606040523615610074576000357c0100000000000000000000000000000000000000000000000000000000900480631d143848146100765780636bdedcf0146100af5780638465eb30146100e2578063ba1643c7146100fa578063cbf1304d14610138578063fd380cb31461016d57610074565b005b61008360048050506105d0565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6100e060048080359060200190919080359060200190919080359060200190919080359060200190919050506104c2565b005b6100f860048080359060200190919050506103e3565b005b61012260048080359060200190919080359060200190919080359060200190919050506101c2565b6040518082815260200191505060405180910390f35b6101576004808035906020019091908035906020019091905050610197565b6040518082815260200191505060405180910390f35b61019560048080359060200190919080359060200190919080359060200190919050506102c8565b005b6003600050602052816000526040600020600050602052806000526040600020600091509150505481565b600082600360005060003373ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600050600084815260200190815260200160002060005054101561021857600090506102c1565b82600360005060003373ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600050600084815260200190815260200160002060008282825054039250508190555082600360005060008673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000506000848152602001908152602001600020600082828250540192505081905550600190506102c1565b9392505050565b82600360005060003373ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000506000848152602001908152602001600020600050541015610318576103de565b6002600050600083815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663c52ab778338584604051847c0100000000000000000000000000000000000000000000000000000000028152600401808473ffffffffffffffffffffffffffffffffffffffff16815260200183815260200182815260200193505050506000604051808303816000876161da5a03f115610002575050505b505050565b3373ffffffffffffffffffffffffffffffffffffffff16600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614151561043f576104bf565b8073ffffffffffffffffffffffffffffffffffffffff1660026000506000600160005054815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16145060016000818150548092919060010191905055505b50565b60006002600050600086815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610534576105c9565b82600360005060008673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060005060008481526020019081526020016000206000505401905080600360005060008673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000506000848152602001908152602001600020600050819055506105c9565b5050505050565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff168156',
            gas: 3000000
        };

        securityContract.new(quant, registry, options, onSecurityCreated);

    }
});

/**
 * This method gets executed whenever new security gets deployed to the blockchain.
 * @param err - Error object
 * @param contract - Contract object
 */
function onSecurityCreated(err, contract){

    if (err) {
        console.log(err.toString());
        return;
    }

    if (typeof contract.address != 'undefined') {
        console.log('Security created: ' + contract.address);
    }

}